"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/chat";
exports.ids = ["pages/api/chat"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cchat.ts&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cchat.ts&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_chat_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\chat.ts */ \"(api)/./pages/api/chat.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_chat_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_chat_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/chat\",\n        pathname: \"/api/chat\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_chat_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNoYXQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2NoYXQudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDa0Q7QUFDbEQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLCtDQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywrQ0FBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9idWRkeS1jaGF0Lz9iYmUyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlc1xcXFxhcGlcXFxcY2hhdC50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2NoYXRcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jaGF0XCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cchat.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/chat.ts":
/*!***************************!*\
  !*** ./pages/api/chat.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\nconst GEMINI_API_URL = \"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent\";\nconst MISTRAL_API_URL = \"https://api.mistral.ai/v1/chat/completions\";\nconst CLAUDE_API_URL = \"https://api.anthropic.com/v1/messages\";\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            message: \"Method not allowed\"\n        });\n    }\n    const { message, model, responseLength = \"medium\", temperature = 0.7, chatMode = \"standard\", apiKey } = req.body;\n    // Calculate max tokens based on response length setting\n    const getMaxTokens = ()=>{\n        switch(responseLength){\n            case \"short\":\n                return 300;\n            case \"medium\":\n                return 1000;\n            case \"long\":\n                return 2000;\n            default:\n                return 1000;\n        }\n    };\n    const maxTokens = getMaxTokens();\n    // Optional: Add specialized model parameters based on chat mode\n    const getModeSpecificParams = (modelType)=>{\n        // Base settings\n        const params = {\n            temperature: parseFloat(temperature.toString()),\n            max_tokens: maxTokens\n        };\n        // Add model-specific adjustments for each chat mode\n        switch(chatMode){\n            case \"coding\":\n                // Optimal for code generation\n                if (modelType === \"gemini\") {\n                    params.topP = 0.95;\n                    params.topK = 40;\n                } else if (modelType === \"mistral\") {\n                    params.top_p = 0.95;\n                }\n                break;\n            case \"precise\":\n                // Lower temperature already set, but add other precision parameters\n                if (modelType === \"gemini\") {\n                    params.topP = 0.75;\n                } else if (modelType === \"mistral\") {\n                    params.top_p = 0.75;\n                }\n                break;\n            case \"creative\":\n                // Higher temperature already set, can add other creativity parameters\n                if (modelType === \"gemini\") {\n                    params.topP = 0.98;\n                    params.topK = 60;\n                } else if (modelType === \"mistral\") {\n                    params.top_p = 0.98;\n                }\n                break;\n        }\n        return params;\n    };\n    try {\n        switch(model){\n            case \"gemini\":\n                {\n                    // Use user's API key if provided, otherwise use environment variable\n                    const currentApiKey = apiKey || process.env.GEMINI_API_KEY;\n                    if (!currentApiKey) {\n                        return res.status(400).json({\n                            error: \"Missing API key for Gemini\",\n                            requiresApiKey: true\n                        });\n                    }\n                    // Test that the Gemini API key is roughly valid (it should be a non-empty string)\n                    if (typeof currentApiKey !== \"string\" || !currentApiKey.trim()) {\n                        return res.status(401).json({\n                            error: \"Invalid Gemini API key format\",\n                            invalidApiKey: true\n                        });\n                    }\n                    // Apply chat mode specific parameters\n                    const modeParams = getModeSpecificParams(\"gemini\");\n                    const geminiResponse = await fetch(`${GEMINI_API_URL}?key=${currentApiKey}`, {\n                        method: \"POST\",\n                        headers: {\n                            \"Content-Type\": \"application/json\"\n                        },\n                        body: JSON.stringify({\n                            contents: [\n                                {\n                                    parts: [\n                                        {\n                                            text: message\n                                        }\n                                    ]\n                                }\n                            ],\n                            generationConfig: {\n                                maxOutputTokens: maxTokens,\n                                temperature: modeParams.temperature,\n                                topP: modeParams.topP || undefined,\n                                topK: modeParams.topK || undefined\n                            }\n                        })\n                    });\n                    // Handle error responses\n                    if (!geminiResponse.ok) {\n                        const errorText = await geminiResponse.text();\n                        console.error(\"Gemini API Error:\", errorText);\n                        return res.status(geminiResponse.status).json({\n                            error: `Gemini API error: ${geminiResponse.statusText}`,\n                            details: errorText,\n                            invalidApiKey: geminiResponse.status === 400 || geminiResponse.status === 401\n                        });\n                    }\n                    const geminiData = await geminiResponse.json();\n                    if (!geminiData.candidates || !geminiData.candidates[0]?.content?.parts?.[0]?.text) {\n                        return res.status(500).json({\n                            error: \"Invalid response structure from Gemini\"\n                        });\n                    }\n                    return res.status(200).json({\n                        text: geminiData.candidates[0].content.parts[0].text,\n                        chatMode: chatMode // Return the chat mode used\n                    });\n                }\n            case \"claude\":\n                {\n                    // Use user's API key if provided, otherwise use environment variable\n                    const currentApiKey = apiKey || process.env.CLAUDE_API_KEY;\n                    if (!currentApiKey) {\n                        return res.status(400).json({\n                            error: \"Missing API key for Claude\",\n                            requiresApiKey: true\n                        });\n                    }\n                    // Test that the Claude API key is roughly valid (it should be a non-empty string)\n                    if (typeof currentApiKey !== \"string\" || !currentApiKey.trim()) {\n                        return res.status(401).json({\n                            error: \"Invalid Claude API key format\",\n                            invalidApiKey: true\n                        });\n                    }\n                    // Apply chat mode specific parameters\n                    const modeParams = getModeSpecificParams(\"claude\");\n                    const claudeResponse = await fetch(CLAUDE_API_URL, {\n                        method: \"POST\",\n                        headers: {\n                            \"Content-Type\": \"application/json\",\n                            \"anthropic-version\": \"2023-06-01\",\n                            \"x-api-key\": currentApiKey\n                        },\n                        body: JSON.stringify({\n                            model: \"claude-3-sonnet-20240229\",\n                            messages: [\n                                {\n                                    role: \"user\",\n                                    content: message\n                                }\n                            ],\n                            stream: true,\n                            max_tokens: maxTokens,\n                            temperature: modeParams.temperature\n                        })\n                    });\n                    if (!claudeResponse.ok) {\n                        const errorText = await claudeResponse.text();\n                        console.error(\"Claude API Error:\", errorText);\n                        return res.status(claudeResponse.status).json({\n                            error: `Claude API error: ${claudeResponse.statusText}`,\n                            details: errorText,\n                            invalidApiKey: claudeResponse.status === 400 || claudeResponse.status === 401\n                        });\n                    }\n                    // Set headers for streaming\n                    res.setHeader(\"Content-Type\", \"text/event-stream\");\n                    res.setHeader(\"Cache-Control\", \"no-cache\");\n                    res.setHeader(\"Connection\", \"keep-alive\");\n                    const reader = claudeResponse.body?.getReader();\n                    const decoder = new TextDecoder();\n                    try {\n                        while(true){\n                            const { done, value } = await reader.read();\n                            if (done) break;\n                            const chunk = decoder.decode(value);\n                            const lines = chunk.split(\"\\n\");\n                            for (const line of lines){\n                                if (line.startsWith(\"data: \") && line !== \"data: [DONE]\") {\n                                    try {\n                                        const data = JSON.parse(line.slice(6));\n                                        if (data.type === \"content_block_delta\" && data.delta?.text) {\n                                            res.write(`data: ${JSON.stringify({\n                                                text: data.delta.text,\n                                                chatMode: chatMode // Add the chat mode to stream data\n                                            })}\\n\\n`);\n                                        }\n                                    } catch (e) {\n                                        console.error(\"Error parsing SSE data:\", e);\n                                    }\n                                }\n                            }\n                        }\n                    } finally{\n                        reader?.releaseLock();\n                        res.end();\n                    }\n                    return;\n                }\n            case \"mistral\":\n                {\n                    // Use user's API key if provided, otherwise use environment variable\n                    const currentApiKey = apiKey || process.env.MISTRAL_API_KEY;\n                    if (!currentApiKey) {\n                        return res.status(400).json({\n                            error: \"Missing API key for Mistral\",\n                            requiresApiKey: true\n                        });\n                    }\n                    // Test that the Mistral API key is roughly valid (it should be a non-empty string)\n                    if (typeof currentApiKey !== \"string\" || !currentApiKey.trim()) {\n                        return res.status(401).json({\n                            error: \"Invalid Mistral API key format\",\n                            invalidApiKey: true\n                        });\n                    }\n                    // Apply chat mode specific parameters\n                    const modeParams = getModeSpecificParams(\"mistral\");\n                    const mistralResponse = await fetch(MISTRAL_API_URL, {\n                        method: \"POST\",\n                        headers: {\n                            \"Content-Type\": \"application/json\",\n                            \"Authorization\": `Bearer ${currentApiKey}`\n                        },\n                        body: JSON.stringify({\n                            model: \"mistral-tiny\",\n                            messages: [\n                                {\n                                    role: \"user\",\n                                    content: message\n                                }\n                            ],\n                            max_tokens: maxTokens,\n                            temperature: modeParams.temperature,\n                            top_p: modeParams.top_p || undefined\n                        })\n                    });\n                    if (!mistralResponse.ok) {\n                        const errorText = await mistralResponse.text();\n                        console.error(\"Mistral API Error:\", errorText);\n                        return res.status(mistralResponse.status).json({\n                            error: `Mistral API error: ${mistralResponse.statusText}`,\n                            details: errorText,\n                            invalidApiKey: mistralResponse.status === 400 || mistralResponse.status === 401\n                        });\n                    }\n                    const mistralData = await mistralResponse.json();\n                    return res.status(200).json({\n                        text: mistralData.choices?.[0]?.message?.content || \"No response from Mistral\",\n                        chatMode: chatMode\n                    });\n                }\n            default:\n                return res.status(400).json({\n                    message: \"Invalid model specified\"\n                });\n        }\n    } catch (error) {\n        console.error(\"API Error:\", error);\n        return res.status(500).json({\n            error: error.message || \"Internal server error\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O29CQUNGO29CQUVBLE1BQU04RSxjQUFjLE1BQU1ELGdCQUFnQjVFLElBQUk7b0JBQzlDLE9BQU9ILElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7d0JBQzFCbUMsTUFBTTBDLFlBQVlDLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRTdFLFNBQVM2QyxXQUFXO3dCQUNwRHpDLFVBQVVBO29CQUNaO2dCQUNGO1lBRUE7Z0JBQ0UsT0FBT1IsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRUMsU0FBUztnQkFBMEI7UUFDckU7SUFDRixFQUFFLE9BQU9zQixPQUFZO1FBQ25Ca0IsUUFBUWxCLEtBQUssQ0FBQyxjQUFjQTtRQUM1QixPQUFPMUIsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQnVCLE9BQU9BLE1BQU10QixPQUFPLElBQUk7UUFDMUI7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYnVkZHktY2hhdC8uL3BhZ2VzL2FwaS9jaGF0LnRzP2M1NzciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xyXG5cclxuY29uc3QgR0VNSU5JX0FQSV9VUkwgPSAnaHR0cHM6Ly9nZW5lcmF0aXZlbGFuZ3VhZ2UuZ29vZ2xlYXBpcy5jb20vdjFiZXRhL21vZGVscy9nZW1pbmktMi4wLWZsYXNoOmdlbmVyYXRlQ29udGVudCc7XHJcbmNvbnN0IE1JU1RSQUxfQVBJX1VSTCA9ICdodHRwczovL2FwaS5taXN0cmFsLmFpL3YxL2NoYXQvY29tcGxldGlvbnMnO1xyXG5jb25zdCBDTEFVREVfQVBJX1VSTCA9ICdodHRwczovL2FwaS5hbnRocm9waWMuY29tL3YxL21lc3NhZ2VzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcclxuICBpZiAocmVxLm1ldGhvZCAhPT0gJ1BPU1QnKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBtZXNzYWdlOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHsgbWVzc2FnZSwgbW9kZWwsIHJlc3BvbnNlTGVuZ3RoID0gJ21lZGl1bScsIHRlbXBlcmF0dXJlID0gMC43LCBjaGF0TW9kZSA9ICdzdGFuZGFyZCcsIGFwaUtleSB9ID0gcmVxLmJvZHk7XHJcbiAgXHJcbiAgLy8gQ2FsY3VsYXRlIG1heCB0b2tlbnMgYmFzZWQgb24gcmVzcG9uc2UgbGVuZ3RoIHNldHRpbmdcclxuICBjb25zdCBnZXRNYXhUb2tlbnMgPSAoKSA9PiB7XHJcbiAgICBzd2l0Y2ggKHJlc3BvbnNlTGVuZ3RoKSB7XHJcbiAgICAgIGNhc2UgJ3Nob3J0JzogcmV0dXJuIDMwMDtcclxuICAgICAgY2FzZSAnbWVkaXVtJzogcmV0dXJuIDEwMDA7XHJcbiAgICAgIGNhc2UgJ2xvbmcnOiByZXR1cm4gMjAwMDtcclxuICAgICAgZGVmYXVsdDogcmV0dXJuIDEwMDA7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgbWF4VG9rZW5zID0gZ2V0TWF4VG9rZW5zKCk7XHJcblxyXG4gIC8vIE9wdGlvbmFsOiBBZGQgc3BlY2lhbGl6ZWQgbW9kZWwgcGFyYW1ldGVycyBiYXNlZCBvbiBjaGF0IG1vZGVcclxuICBjb25zdCBnZXRNb2RlU3BlY2lmaWNQYXJhbXMgPSAobW9kZWxUeXBlOiBzdHJpbmcpID0+IHtcclxuICAgIC8vIEJhc2Ugc2V0dGluZ3NcclxuICAgIGNvbnN0IHBhcmFtczogYW55ID0geyBcclxuICAgICAgdGVtcGVyYXR1cmU6IHBhcnNlRmxvYXQodGVtcGVyYXR1cmUudG9TdHJpbmcoKSksXHJcbiAgICAgIG1heF90b2tlbnM6IG1heFRva2Vuc1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gQWRkIG1vZGVsLXNwZWNpZmljIGFkanVzdG1lbnRzIGZvciBlYWNoIGNoYXQgbW9kZVxyXG4gICAgc3dpdGNoIChjaGF0TW9kZSkge1xyXG4gICAgICBjYXNlICdjb2RpbmcnOlxyXG4gICAgICAgIC8vIE9wdGltYWwgZm9yIGNvZGUgZ2VuZXJhdGlvblxyXG4gICAgICAgIGlmIChtb2RlbFR5cGUgPT09ICdnZW1pbmknKSB7XHJcbiAgICAgICAgICBwYXJhbXMudG9wUCA9IDAuOTU7XHJcbiAgICAgICAgICBwYXJhbXMudG9wSyA9IDQwO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobW9kZWxUeXBlID09PSAnbWlzdHJhbCcpIHtcclxuICAgICAgICAgIHBhcmFtcy50b3BfcCA9IDAuOTU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICAgIFxyXG4gICAgICBjYXNlICdwcmVjaXNlJzpcclxuICAgICAgICAvLyBMb3dlciB0ZW1wZXJhdHVyZSBhbHJlYWR5IHNldCwgYnV0IGFkZCBvdGhlciBwcmVjaXNpb24gcGFyYW1ldGVyc1xyXG4gICAgICAgIGlmIChtb2RlbFR5cGUgPT09ICdnZW1pbmknKSB7XHJcbiAgICAgICAgICBwYXJhbXMudG9wUCA9IDAuNzU7XHJcbiAgICAgICAgfSBlbHNlIGlmIChtb2RlbFR5cGUgPT09ICdtaXN0cmFsJykge1xyXG4gICAgICAgICAgcGFyYW1zLnRvcF9wID0gMC43NTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgXHJcbiAgICAgIGNhc2UgJ2NyZWF0aXZlJzpcclxuICAgICAgICAvLyBIaWdoZXIgdGVtcGVyYXR1cmUgYWxyZWFkeSBzZXQsIGNhbiBhZGQgb3RoZXIgY3JlYXRpdml0eSBwYXJhbWV0ZXJzXHJcbiAgICAgICAgaWYgKG1vZGVsVHlwZSA9PT0gJ2dlbWluaScpIHtcclxuICAgICAgICAgIHBhcmFtcy50b3BQID0gMC45ODtcclxuICAgICAgICAgIHBhcmFtcy50b3BLID0gNjA7XHJcbiAgICAgICAgfSBlbHNlIGlmIChtb2RlbFR5cGUgPT09ICdtaXN0cmFsJykge1xyXG4gICAgICAgICAgcGFyYW1zLnRvcF9wID0gMC45ODtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgXHJcbiAgICAgIC8vIEFkZCBhbnkgb3RoZXIgbW9kZS1zcGVjaWZpYyBwYXJhbWV0ZXIgYWRqdXN0bWVudHNcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHBhcmFtcztcclxuICB9O1xyXG5cclxuICB0cnkge1xyXG4gICAgc3dpdGNoIChtb2RlbCkge1xyXG4gICAgICBjYXNlICdnZW1pbmknOiB7XHJcbiAgICAgICAgLy8gVXNlIHVzZXIncyBBUEkga2V5IGlmIHByb3ZpZGVkLCBvdGhlcndpc2UgdXNlIGVudmlyb25tZW50IHZhcmlhYmxlXHJcbiAgICAgICAgY29uc3QgY3VycmVudEFwaUtleSA9IGFwaUtleSB8fCBwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWTtcclxuXHJcbiAgICAgICAgaWYgKCFjdXJyZW50QXBpS2V5KSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBcclxuICAgICAgICAgICAgZXJyb3I6ICdNaXNzaW5nIEFQSSBrZXkgZm9yIEdlbWluaScsXHJcbiAgICAgICAgICAgIHJlcXVpcmVzQXBpS2V5OiB0cnVlXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFRlc3QgdGhhdCB0aGUgR2VtaW5pIEFQSSBrZXkgaXMgcm91Z2hseSB2YWxpZCAoaXQgc2hvdWxkIGJlIGEgbm9uLWVtcHR5IHN0cmluZylcclxuICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnRBcGlLZXkgIT09ICdzdHJpbmcnIHx8ICFjdXJyZW50QXBpS2V5LnRyaW0oKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgXHJcbiAgICAgICAgICAgIGVycm9yOiAnSW52YWxpZCBHZW1pbmkgQVBJIGtleSBmb3JtYXQnLFxyXG4gICAgICAgICAgICBpbnZhbGlkQXBpS2V5OiB0cnVlXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEFwcGx5IGNoYXQgbW9kZSBzcGVjaWZpYyBwYXJhbWV0ZXJzXHJcbiAgICAgICAgY29uc3QgbW9kZVBhcmFtcyA9IGdldE1vZGVTcGVjaWZpY1BhcmFtcygnZ2VtaW5pJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgZ2VtaW5pUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtHRU1JTklfQVBJX1VSTH0/a2V5PSR7Y3VycmVudEFwaUtleX1gLCB7XHJcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgIGhlYWRlcnM6IHsgXHJcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgIGNvbnRlbnRzOiBbXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGFydHM6IFtcclxuICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgZ2VuZXJhdGlvbkNvbmZpZzoge1xyXG4gICAgICAgICAgICAgIG1heE91dHB1dFRva2VuczogbWF4VG9rZW5zLFxyXG4gICAgICAgICAgICAgIHRlbXBlcmF0dXJlOiBtb2RlUGFyYW1zLnRlbXBlcmF0dXJlLFxyXG4gICAgICAgICAgICAgIHRvcFA6IG1vZGVQYXJhbXMudG9wUCB8fCB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgdG9wSzogbW9kZVBhcmFtcy50b3BLIHx8IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gSGFuZGxlIGVycm9yIHJlc3BvbnNlc1xyXG4gICAgICAgIGlmICghZ2VtaW5pUmVzcG9uc2Uub2spIHtcclxuICAgICAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IGdlbWluaVJlc3BvbnNlLnRleHQoKTtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0dlbWluaSBBUEkgRXJyb3I6JywgZXJyb3JUZXh0KTtcclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKGdlbWluaVJlc3BvbnNlLnN0YXR1cykuanNvbih7IFxyXG4gICAgICAgICAgICBlcnJvcjogYEdlbWluaSBBUEkgZXJyb3I6ICR7Z2VtaW5pUmVzcG9uc2Uuc3RhdHVzVGV4dH1gLFxyXG4gICAgICAgICAgICBkZXRhaWxzOiBlcnJvclRleHQsXHJcbiAgICAgICAgICAgIGludmFsaWRBcGlLZXk6IGdlbWluaVJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwIHx8IGdlbWluaVJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGdlbWluaURhdGEgPSBhd2FpdCBnZW1pbmlSZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKCFnZW1pbmlEYXRhLmNhbmRpZGF0ZXMgfHwgIWdlbWluaURhdGEuY2FuZGlkYXRlc1swXT8uY29udGVudD8ucGFydHM/LlswXT8udGV4dCkge1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnZhbGlkIHJlc3BvbnNlIHN0cnVjdHVyZSBmcm9tIEdlbWluaScgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICAgICAgdGV4dDogZ2VtaW5pRGF0YS5jYW5kaWRhdGVzWzBdLmNvbnRlbnQucGFydHNbMF0udGV4dCxcclxuICAgICAgICAgIGNoYXRNb2RlOiBjaGF0TW9kZSAvLyBSZXR1cm4gdGhlIGNoYXQgbW9kZSB1c2VkXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNhc2UgJ2NsYXVkZSc6IHtcclxuICAgICAgICAvLyBVc2UgdXNlcidzIEFQSSBrZXkgaWYgcHJvdmlkZWQsIG90aGVyd2lzZSB1c2UgZW52aXJvbm1lbnQgdmFyaWFibGVcclxuICAgICAgICBjb25zdCBjdXJyZW50QXBpS2V5ID0gYXBpS2V5IHx8IHByb2Nlc3MuZW52LkNMQVVERV9BUElfS0VZO1xyXG5cclxuICAgICAgICBpZiAoIWN1cnJlbnRBcGlLZXkpIHtcclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IFxyXG4gICAgICAgICAgICBlcnJvcjogJ01pc3NpbmcgQVBJIGtleSBmb3IgQ2xhdWRlJyxcclxuICAgICAgICAgICAgcmVxdWlyZXNBcGlLZXk6IHRydWVcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVGVzdCB0aGF0IHRoZSBDbGF1ZGUgQVBJIGtleSBpcyByb3VnaGx5IHZhbGlkIChpdCBzaG91bGQgYmUgYSBub24tZW1wdHkgc3RyaW5nKVxyXG4gICAgICAgIGlmICh0eXBlb2YgY3VycmVudEFwaUtleSAhPT0gJ3N0cmluZycgfHwgIWN1cnJlbnRBcGlLZXkudHJpbSgpKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBcclxuICAgICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIENsYXVkZSBBUEkga2V5IGZvcm1hdCcsXHJcbiAgICAgICAgICAgIGludmFsaWRBcGlLZXk6IHRydWVcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQXBwbHkgY2hhdCBtb2RlIHNwZWNpZmljIHBhcmFtZXRlcnNcclxuICAgICAgICBjb25zdCBtb2RlUGFyYW1zID0gZ2V0TW9kZVNwZWNpZmljUGFyYW1zKCdjbGF1ZGUnKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBjbGF1ZGVSZXNwb25zZSA9IGF3YWl0IGZldGNoKENMQVVERV9BUElfVVJMLCB7XHJcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgJ2FudGhyb3BpYy12ZXJzaW9uJzogJzIwMjMtMDYtMDEnLFxyXG4gICAgICAgICAgICAneC1hcGkta2V5JzogY3VycmVudEFwaUtleSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgIG1vZGVsOiAnY2xhdWRlLTMtc29ubmV0LTIwMjQwMjI5JyxcclxuICAgICAgICAgICAgbWVzc2FnZXM6IFt7IHJvbGU6ICd1c2VyJywgY29udGVudDogbWVzc2FnZSB9XSxcclxuICAgICAgICAgICAgc3RyZWFtOiB0cnVlLFxyXG4gICAgICAgICAgICBtYXhfdG9rZW5zOiBtYXhUb2tlbnMsXHJcbiAgICAgICAgICAgIHRlbXBlcmF0dXJlOiBtb2RlUGFyYW1zLnRlbXBlcmF0dXJlLFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICghY2xhdWRlUmVzcG9uc2Uub2spIHtcclxuICAgICAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IGNsYXVkZVJlc3BvbnNlLnRleHQoKTtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NsYXVkZSBBUEkgRXJyb3I6JywgZXJyb3JUZXh0KTtcclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKGNsYXVkZVJlc3BvbnNlLnN0YXR1cykuanNvbih7IFxyXG4gICAgICAgICAgICBlcnJvcjogYENsYXVkZSBBUEkgZXJyb3I6ICR7Y2xhdWRlUmVzcG9uc2Uuc3RhdHVzVGV4dH1gLFxyXG4gICAgICAgICAgICBkZXRhaWxzOiBlcnJvclRleHQsXHJcbiAgICAgICAgICAgIGludmFsaWRBcGlLZXk6IGNsYXVkZVJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwIHx8IGNsYXVkZVJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFNldCBoZWFkZXJzIGZvciBzdHJlYW1pbmdcclxuICAgICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAndGV4dC9ldmVudC1zdHJlYW0nKTtcclxuICAgICAgICByZXMuc2V0SGVhZGVyKCdDYWNoZS1Db250cm9sJywgJ25vLWNhY2hlJyk7XHJcbiAgICAgICAgcmVzLnNldEhlYWRlcignQ29ubmVjdGlvbicsICdrZWVwLWFsaXZlJyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlYWRlciA9IGNsYXVkZVJlc3BvbnNlLmJvZHk/LmdldFJlYWRlcigpO1xyXG4gICAgICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIHdoaWxlICh0cnVlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgZG9uZSwgdmFsdWUgfSA9IGF3YWl0IHJlYWRlciEucmVhZCgpO1xyXG4gICAgICAgICAgICBpZiAoZG9uZSkgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjaHVuayA9IGRlY29kZXIuZGVjb2RlKHZhbHVlKTtcclxuICAgICAgICAgICAgY29uc3QgbGluZXMgPSBjaHVuay5zcGxpdCgnXFxuJyk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcclxuICAgICAgICAgICAgICBpZiAobGluZS5zdGFydHNXaXRoKCdkYXRhOiAnKSAmJiBsaW5lICE9PSAnZGF0YTogW0RPTkVdJykge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UobGluZS5zbGljZSg2KSk7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICdjb250ZW50X2Jsb2NrX2RlbHRhJyAmJiBkYXRhLmRlbHRhPy50ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzLndyaXRlKGBkYXRhOiAke0pTT04uc3RyaW5naWZ5KHsgXHJcbiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBkYXRhLmRlbHRhLnRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICBjaGF0TW9kZTogY2hhdE1vZGUgLy8gQWRkIHRoZSBjaGF0IG1vZGUgdG8gc3RyZWFtIGRhdGFcclxuICAgICAgICAgICAgICAgICAgICB9KX1cXG5cXG5gKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIFNTRSBkYXRhOicsIGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZmluYWxseSB7XHJcbiAgICAgICAgICByZWFkZXI/LnJlbGVhc2VMb2NrKCk7XHJcbiAgICAgICAgICByZXMuZW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY2FzZSAnbWlzdHJhbCc6IHtcclxuICAgICAgICAvLyBVc2UgdXNlcidzIEFQSSBrZXkgaWYgcHJvdmlkZWQsIG90aGVyd2lzZSB1c2UgZW52aXJvbm1lbnQgdmFyaWFibGVcclxuICAgICAgICBjb25zdCBjdXJyZW50QXBpS2V5ID0gYXBpS2V5IHx8IHByb2Nlc3MuZW52Lk1JU1RSQUxfQVBJX0tFWTtcclxuXHJcbiAgICAgICAgaWYgKCFjdXJyZW50QXBpS2V5KSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBcclxuICAgICAgICAgICAgZXJyb3I6ICdNaXNzaW5nIEFQSSBrZXkgZm9yIE1pc3RyYWwnLFxyXG4gICAgICAgICAgICByZXF1aXJlc0FwaUtleTogdHJ1ZVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBUZXN0IHRoYXQgdGhlIE1pc3RyYWwgQVBJIGtleSBpcyByb3VnaGx5IHZhbGlkIChpdCBzaG91bGQgYmUgYSBub24tZW1wdHkgc3RyaW5nKVxyXG4gICAgICAgIGlmICh0eXBlb2YgY3VycmVudEFwaUtleSAhPT0gJ3N0cmluZycgfHwgIWN1cnJlbnRBcGlLZXkudHJpbSgpKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBcclxuICAgICAgICAgICAgZXJyb3I6ICdJbnZhbGlkIE1pc3RyYWwgQVBJIGtleSBmb3JtYXQnLFxyXG4gICAgICAgICAgICBpbnZhbGlkQXBpS2V5OiB0cnVlXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEFwcGx5IGNoYXQgbW9kZSBzcGVjaWZpYyBwYXJhbWV0ZXJzXHJcbiAgICAgICAgY29uc3QgbW9kZVBhcmFtcyA9IGdldE1vZGVTcGVjaWZpY1BhcmFtcygnbWlzdHJhbCcpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IG1pc3RyYWxSZXNwb25zZSA9IGF3YWl0IGZldGNoKE1JU1RSQUxfQVBJX1VSTCwge1xyXG4gICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke2N1cnJlbnRBcGlLZXl9YFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgbW9kZWw6ICdtaXN0cmFsLXRpbnknLFxyXG4gICAgICAgICAgICBtZXNzYWdlczogW3sgcm9sZTogJ3VzZXInLCBjb250ZW50OiBtZXNzYWdlIH1dLFxyXG4gICAgICAgICAgICBtYXhfdG9rZW5zOiBtYXhUb2tlbnMsXHJcbiAgICAgICAgICAgIHRlbXBlcmF0dXJlOiBtb2RlUGFyYW1zLnRlbXBlcmF0dXJlLFxyXG4gICAgICAgICAgICB0b3BfcDogbW9kZVBhcmFtcy50b3BfcCB8fCB1bmRlZmluZWRcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoIW1pc3RyYWxSZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgbWlzdHJhbFJlc3BvbnNlLnRleHQoKTtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ01pc3RyYWwgQVBJIEVycm9yOicsIGVycm9yVGV4dCk7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyhtaXN0cmFsUmVzcG9uc2Uuc3RhdHVzKS5qc29uKHsgXHJcbiAgICAgICAgICAgIGVycm9yOiBgTWlzdHJhbCBBUEkgZXJyb3I6ICR7bWlzdHJhbFJlc3BvbnNlLnN0YXR1c1RleHR9YCxcclxuICAgICAgICAgICAgZGV0YWlsczogZXJyb3JUZXh0LFxyXG4gICAgICAgICAgICBpbnZhbGlkQXBpS2V5OiBtaXN0cmFsUmVzcG9uc2Uuc3RhdHVzID09PSA0MDAgfHwgbWlzdHJhbFJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG1pc3RyYWxEYXRhID0gYXdhaXQgbWlzdHJhbFJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICAgICAgdGV4dDogbWlzdHJhbERhdGEuY2hvaWNlcz8uWzBdPy5tZXNzYWdlPy5jb250ZW50IHx8ICdObyByZXNwb25zZSBmcm9tIE1pc3RyYWwnLFxyXG4gICAgICAgICAgY2hhdE1vZGU6IGNoYXRNb2RlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ0ludmFsaWQgbW9kZWwgc3BlY2lmaWVkJyB9KTtcclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdBUEkgRXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXHJcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlIHx8ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIkdFTUlOSV9BUElfVVJMIiwiTUlTVFJBTF9BUElfVVJMIiwiQ0xBVURFX0FQSV9VUkwiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJtb2RlbCIsInJlc3BvbnNlTGVuZ3RoIiwidGVtcGVyYXR1cmUiLCJjaGF0TW9kZSIsImFwaUtleSIsImJvZHkiLCJnZXRNYXhUb2tlbnMiLCJtYXhUb2tlbnMiLCJnZXRNb2RlU3BlY2lmaWNQYXJhbXMiLCJtb2RlbFR5cGUiLCJwYXJhbXMiLCJwYXJzZUZsb2F0IiwidG9TdHJpbmciLCJtYXhfdG9rZW5zIiwidG9wUCIsInRvcEsiLCJ0b3BfcCIsImN1cnJlbnRBcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiR0VNSU5JX0FQSV9LRVkiLCJlcnJvciIsInJlcXVpcmVzQXBpS2V5IiwidHJpbSIsImludmFsaWRBcGlLZXkiLCJtb2RlUGFyYW1zIiwiZ2VtaW5pUmVzcG9uc2UiLCJmZXRjaCIsImhlYWRlcnMiLCJKU09OIiwic3RyaW5naWZ5IiwiY29udGVudHMiLCJwYXJ0cyIsInRleHQiLCJnZW5lcmF0aW9uQ29uZmlnIiwibWF4T3V0cHV0VG9rZW5zIiwidW5kZWZpbmVkIiwib2siLCJlcnJvclRleHQiLCJjb25zb2xlIiwic3RhdHVzVGV4dCIsImRldGFpbHMiLCJnZW1pbmlEYXRhIiwiY2FuZGlkYXRlcyIsImNvbnRlbnQiLCJDTEFVREVfQVBJX0tFWSIsImNsYXVkZVJlc3BvbnNlIiwibWVzc2FnZXMiLCJyb2xlIiwic3RyZWFtIiwic2V0SGVhZGVyIiwicmVhZGVyIiwiZ2V0UmVhZGVyIiwiZGVjb2RlciIsIlRleHREZWNvZGVyIiwiZG9uZSIsInZhbHVlIiwicmVhZCIsImNodW5rIiwiZGVjb2RlIiwibGluZXMiLCJzcGxpdCIsImxpbmUiLCJzdGFydHNXaXRoIiwiZGF0YSIsInBhcnNlIiwic2xpY2UiLCJ0eXBlIiwiZGVsdGEiLCJ3cml0ZSIsImUiLCJyZWxlYXNlTG9jayIsImVuZCIsIk1JU1RSQUxfQVBJX0tFWSIsIm1pc3RyYWxSZXNwb25zZSIsIm1pc3RyYWxEYXRhIiwiY2hvaWNlcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/chat.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cchat.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();